#!/bin/bash

{{ $plugins := dict
  "1password-cli" "1.12.4"
  "aria2"         "1.36.0"
  "cue"           "0.4.2"
  "crystal"       "1.4.0"
  "dive"          "0.10.0"
  "exa"           "0.10.1"
  "gohugo"        "0.97.3"
  "golang"        "1.18"
  "goreleaser"    "1.7.0"
  "hadolint"      "v2.10.0"
  "lua"           "5.4.3"
  "mitmproxy"     "8.0.0"
  "neovim"        "0.6.1"
  "nodejs"        "lts"
  "python"        "3.9.9"
  "ruby"          "3.0.2"
  "rust"          "nightly"
  "saml2aws"      "2.34.0"
  "shellcheck"    "0.8.0"
  "sqlite"        "3.38.2"
  "tmux"          "3.2"
  "upx"           "3.96"
  "yarn"          "1.22.18"
}}

{{ $workMode := eq (output "sysctl" "-n" "hw.model" | trim) "MacBookPro16,4" }}

{{- if $workMode }}
  {{ $_ := set $plugins "terraform" "0.13.7" }}
{{ else }}
  {{ $_ := set $plugins "terraform" "1.0.10"}}
{{ end -}}

asdf update >/dev/null 2>&1 || true && echo "~ asdf has been updated"

echo "~ languages (installations)"

{{ range sortAlpha (keys $plugins) -}}
  asdf plugin-add {{ . }} >/dev/null 2>&1 || true
  asdf install {{ . }} {{ get $plugins . }} >/dev/null 2>&1 || true && echo "~~ {{ . }} {{ get $plugins . }} is installed"
  asdf global {{ . }} {{ get $plugins . }} >/dev/null 2>&1 || true
{{ end -}}

# -- Globally installed packages -- #

{{ $goPackages := list
   "github.com/cweill/gotests/...@latest"
   "github.com/fatih/gomodifytags@latest"
   "github.com/go-delve/delve/cmd/dlv@latest"
   "github.com/golang/mock/mockgen@v1.6.0"
   "github.com/mdempsky/gocode@latest"
   "github.com/segmentio/golines@latest"
   "github.com/wailsapp/wails/v2/cmd/wails@latest"
   "github.com/x-motemen/gore/cmd/gore@latest"
   "golang.org/x/tools/cmd/goimports@latest"
   "golang.org/x/tools/cmd/guru@latest"
   "mvdan.cc/gofumpt@latest"
}}

{{ $npmPackages := list
   "@datadog/datadog-ci"
   "eslint"
   "js-beautify"
   "neovim"
   "npm"
   "pkgparse"
   "pnpm"
   "stylelint"
   "tree-sitter-cli"
   "yarn"
}}

{{ $pythonPackages := list
   "ansible"
   "beautifulsoup4"
   "beets"
   "black"
   "Django"
   "dnspython"
   "flake8"
   "isort"
   "mkdocs"
   "mkdocs-techdocs-core"
   "nose"
   "pip"
   "pipenv"
   "poetry"
   "PyGithub"
   "pylast"
   "pynvim"
   "pyusb"
   "pyyaml"
   "requests"
}}

{{ $rubyPackages := list
   "bundler"
   "neovim"
}}

echo "~ languages (libraries)"

# --- Install libraries --- #
echo "~~ go libraries"
{{ range sortAlpha $goPackages }}
  go install {{ . }} >/dev/null 2>&1 || true && echo "~~~ {{ . }} is installed"
{{ end -}}

echo "~~ npm libraries"
{{ range sortAlpha $npmPackages -}}
  npm install -g {{ . }} >/dev/null 2>&1 || true && echo "~~~ {{ . }} is installed"
{{ end -}}

echo "~~ python libraries"
{{ range sortAlpha $pythonPackages -}}
  pip install -U {{ . }} >/dev/null 2>&1 || true && echo "~~~ {{ . }} is installed"
{{ end -}}

echo "~~ ruby libraries"
{{ range sortAlpha $rubyPackages }}
  gem install {{ . }} >/dev/null 2>&1 || true && echo "~~~ {{ . }} is installed"
{{ end -}}
